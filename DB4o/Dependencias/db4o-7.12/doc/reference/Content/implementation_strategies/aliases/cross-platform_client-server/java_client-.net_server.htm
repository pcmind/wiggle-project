<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="2" MadCap:lastHeight="120" MadCap:lastWidth="624" MadCap:disableMasterStylesheet="true" MadCap:tocPath="Implementation Strategies|Aliases|Cross-Platform Client-Server" MadCap:InPreviewMode="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" MadCap:PathToHelpSystem="../../../../" MadCap:HelpSystemFileName="index.xml" MadCap:SearchType="Stem">
    <head><title>Java Client-.NET Server	</title>
        <script type="text/javascript">/* <![CDATA[ */
			window.onload = function(){
                             prettyPrint();
			};
                /* ]]> */</script>
        <link href="../../../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/OnlineStyle.css" rel="stylesheet" />
        <script src="../../../Resources/Code/prettify.js">
        </script>
        <script src="../../../Resources/Code/lang-vb.js">
        </script>
        <script src="../../../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink" style="display: none;"><a href="../../../../index_CSH.html#implementation_strategies/aliases/cross-platform_client-server/java_client-.net_server.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../../../implementation_strategies.htm">Implementation Strategies</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../../aliases.htm">Aliases</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../cross-platform_client-server.htm">Cross-Platform Client-Server</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Java Client-.Net Server</span>
        </div>
        <p>
            <script type="text/javascript">/*<![CDATA[*/document.write('<a href="' + location.href +'">');
				document.write("Direct Link");
			document.write('</a>');/*]]>*/</script>
        </p>
        <p>
        </p>
        <h1>Java Client-.NET Server</h1>
        <p>In the <a href="java_server-.net_client.htm">previous example</a> we
saw how to access Java server from .NET clients. The opposite is also possible.</p>
        <p>Let's start a typical .NET db4o server (c# or VB):</p>
        <p>c#: </p>
        <pre class="prettyprint" xml:space="preserve">StartServer.cs
/**//* Copyright (C) 2004 - 2009  Versant Corporation http://www.versant.com */
using System;
using System.Threading;
using Db4objects.Db4o;
using Db4objects.Db4o.Config;
using Db4objects.Db4o.Messaging;


namespace JavaDotnetClientServer
 {
    class StartServer : ServerInfo, IMessageRecipient
     {
        private bool stop = false;

        /**//// &lt;summary&gt;
        /// starts a db4o server using the configuration from
        /// ServerInfo.
        /// &lt;/summary&gt;
        public static void Main(string[] arguments)
         {
            new StartServer().RunServer();
        }
        // end Main

        /**//// &lt;summary&gt;
        /// opens the IObjectServer, and waits forever until Close() is called
        /// or a StopServer message is being received.
        /// &lt;/summary&gt;
        public void RunServer()
         {
            lock (this)
             {
                // Using the messaging functionality to redirect all
                // messages to this.processMessage
                IConfiguration configuration = 
Db4oFactory.NewConfiguration();
                configuration.ClientServer().SetMessageRecipient(this);

                IObjectServer db4oServer = Db4oFactory.
OpenServer(configuration, FileName, Port);
                db4oServer.GrantAccess(User, Password);

                try
                 {
                    if (!stop)
                     {
                        // wait forever until Close will change stop variable
                        Monitor.Wait(this);
                    }
                }
                catch (Exception e)
                 {
                    Console.WriteLine(e.ToString());
                }
                db4oServer.Close();
            }
        }
        // end RunServer

        /**//// &lt;summary&gt;
        /// messaging callback
        /// see com.db4o.messaging.MessageRecipient#ProcessMessage()
        /// &lt;/summary&gt;
        public void ProcessMessage(IMessageContext context, object message)
         {
            if (message is StopServer)
             {
                Close();
            }
        }
        // end ProcessMessage

        /**//// &lt;summary&gt;
        /// closes this server.
        /// &lt;/summary&gt;
        public void Close()
         {
            lock (this)
             {
                stop = true;
                Monitor.PulseAll(this);
            }
        }
        // end Close

    }
}</pre>
        <pre class="prettyprint" xml:space="preserve">ServerInfo.cs
/**//* Copyright (C) 2004 - 2009  Versant Corporation http://www.versant.com */
namespace JavaDotnetClientServer
 {
    /**//// &lt;summary&gt;
    /// Configuration used for StartServer and StopServer.
    /// &lt;/summary&gt;
    public class ServerInfo
     {
        /**//// &lt;summary&gt;
        /// the host to be used.
        /// If you want to run the client server examples on two computers,
        /// enter the computer name of the one that you want to use as server. 
        /// &lt;/summary&gt;
        public const string Host = "localhost";  

        /**//// &lt;summary&gt;
        /// the database file to be used by the server.
        /// &lt;/summary&gt;
        public const string FileName = "reference.db4o";

        /**//// &lt;summary&gt;
        /// the port to be used by the server.
        /// &lt;/summary&gt;
        public const int Port = 0xdb40;

        /**//// &lt;summary&gt;
        /// the user name for access control.
        /// &lt;/summary&gt;
        public const string User = "db4o";
    
        /**//// &lt;summary&gt;
        /// the pasword for access control.
        /// &lt;/summary&gt;
        public const string Password = "db4o";
    }
}</pre>.NET:<pre class="prettyprint lang-vb" xml:space="preserve">StartServer.vb
' Copyright (C) 2004 - 2009  Versant Corporation http://www.versant.com 

Imports System
Imports System.Threading
Imports Db4objects.Db4o
Imports Db4objects.Db4o.Config
Imports Db4objects.Db4o.Messaging


Class StartServerClass StartServer
    Inherits ServerInfo
    Implements IMessageRecipient
    Private [stop] As Boolean = False

    /**/''' &lt;summary&gt;
    ''' starts a db4o server using the configuration from
    ''' ServerInfo.
    ''' &lt;/summary&gt;
    Public Shared Sub Main()Sub Main(ByVal arguments As String())
        Dim server As StartServer = New StartServer()
        server.RunServer()
    End Sub
    ' end Main

    /**/''' &lt;summary&gt;
    ''' opens the IObjectServer, and waits forever until Close() is called
    ''' or a StopServer message is being received.
    ''' &lt;/summary&gt;
    Public Sub RunServer()Sub RunServer()
        SyncLock Me
            ' Using the messaging functionality to redirect all
            ' messages to this.processMessage
            Dim configuration As IConfiguration = Db4oFactory.NewConfiguration()
            configuration.ClientServer().SetMessageRecipient(Me)

            Dim db4oServer As IObjectServer = Db4oFactory. _ 
OpenServer(configuration, FileName, Port)
            db4oServer.GrantAccess(User, Password)

            Try
                If Not [stop] Then
                    ' wait forever until Close will change stop variable
                    Monitor.Wait(Me)
                End If
            Catch e As Exception
                Console.WriteLine(e.ToString())
            End Try
            db4oServer.Close()
        End SyncLock
    End Sub
    ' end RunServer

    /**/''' &lt;summary&gt;
    ''' messaging callback
    ''' see com.db4o.messaging.MessageRecipient#ProcessMessage()
    ''' &lt;/summary&gt;
    Public Sub ProcessMessage()Sub ProcessMessage(ByVal context As _ 
IMessageContext, ByVal message As Object) _ 
Implements IMessageRecipient.ProcessMessage
        If TypeOf message Is StopServer Then
            Close()
        End If
    End Sub
    ' end ProcessMessage

    /**/''' &lt;summary&gt;
    ''' closes this server.
    ''' &lt;/summary&gt;
    Public Sub Close()Sub Close()
        SyncLock Me
            [stop] = True
            Monitor.PulseAll(Me)
        End SyncLock
    End Sub
    ' end Close

End Class</pre><pre class="prettyprint lang-vb" xml:space="preserve">ServerInfo.vb
' Copyright (C) 2004 - 2009  Versant Corporation http://www.versant.com 


/**/''' &lt;summary&gt;
''' Configuration used for StartServer and StopServer.
''' &lt;/summary&gt;
Public Class ServerInfoClass ServerInfo
    /**/''' &lt;summary&gt;
    ''' the host to be used.
    ''' If you want to run the client server examples on two computers,
    ''' enter the computer name of the one that you want to use as server. 
    ''' &lt;/summary&gt;
    Public Const Host As String = "localhost"

    /**/''' &lt;summary&gt;
    ''' the database file to be used by the server.
    ''' &lt;/summary&gt;
    Public Const FileName As String = "reference.db4o"

    /**/''' &lt;summary&gt;
    ''' the port to be used by the server.
    ''' &lt;/summary&gt;
    Public Const Port As Integer = &amp;HDB40

    /**/''' &lt;summary&gt;
    ''' the user name for access control.
    ''' &lt;/summary&gt;
    Public Const User As String = "db4o"

    /**/''' &lt;summary&gt;
    ''' the pasword for access control.
    ''' &lt;/summary&gt;
    Public Const Password As String = "db4o"
End Class</pre><p>Remember, that persistent class definitions should be
present both on the client and the server side. For simplicity we will use the
classes from the <a href="java_server-.net_client.htm">previous example</a>.</p><p>Java client testing code:</p><pre class="prettyprint" xml:space="preserve">Client.java: main
public static void main(String[] args)  {
    ObjectContainer db = Db4oClientServer.openClient(getConfig(), host,
        port, user, password);
    db.store(new Car("Ferrari", new Pilot("Michael Schumacher")));
    db.store(new Car("BMW", new Pilot("Rubens Barrichello")));
    db.close();

    db = Db4oClientServer.openClient(getConfig(), host, port, user,
        password);
    List&lt;Car&gt; cars = db.queryByExample(Car.class);
    for (Car car : cars)  {
      System.out.println(car);
    }
    db.close();
  }</pre><p>And the most important part - configuration:</p><pre class="prettyprint" xml:space="preserve">Client.java: getConfig
private static ClientConfiguration getConfig()  {
    ClientConfiguration config = Db4oClientServer.newClientConfiguration();
    config.common().add(new DotnetSupport(true));
    config.common().addAlias(
        new WildcardAlias(
            "JavaDotnetClientServer.*, JavaDotnetClientServer",
            "com.db4odoc.JavaDotNetClientServer.*"));
    return config;
  }</pre><p>Note, that we use DotnetSupport constructor with a boolean parameter
set to true. This parameter defines if Client/Server support should be
included.</p><p>Persistent class aliases are required for accessing object
information on the server (both Wildcard and class-specific aliases can be
used, as soon as they cover all the classes which you want to access).</p><p MadCap:conditions="Primary.Online">Download example code:</p><p MadCap:conditions="Primary.Online"><MadCap:conditionalText MadCap:conditions="Primary.Java"><a href="javadotnetclientserverjava.zip">Java </a></MadCap:conditionalText></p><script type="text/javascript" src="../../../SkinSupport/MadCapBodyEnd.js"></script></body>
</html>