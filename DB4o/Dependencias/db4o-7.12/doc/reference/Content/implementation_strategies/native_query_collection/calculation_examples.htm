<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="2" MadCap:lastHeight="120" MadCap:lastWidth="624" MadCap:disableMasterStylesheet="true" MadCap:tocPath="Implementation Strategies|Native Query Collection" MadCap:InPreviewMode="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" MadCap:PathToHelpSystem="../../../" MadCap:HelpSystemFileName="index.xml" MadCap:SearchType="Stem">
    <head><title>Calculation Examples	</title>
        <script type="text/javascript">/* <![CDATA[ */
			window.onload = function(){
                             prettyPrint();
			};
                /* ]]> */</script>
        <link href="../../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/OnlineStyle.css" rel="stylesheet" />
        <script src="../../Resources/Code/prettify.js">
        </script>
        <script src="../../Resources/Code/lang-vb.js">
        </script>
        <script src="../../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink" style="display: none;"><a href="../../../index_CSH.html#implementation_strategies/native_query_collection/calculation_examples.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../../implementation_strategies.htm">Implementation Strategies</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../native_query_collection.htm">Native Query Collection</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Calculation Examples</span>
        </div>
        <p>
            <script type="text/javascript">/*<![CDATA[*/document.write('<a href="' + location.href +'">');
				document.write("Direct Link");
			document.write('</a>');/*]]>*/</script>
        </p>
        <p>
        </p>
        <h1>Calculation Examples</h1>
        <p>This set of examples shows how to use Native Queries to perform different calculations on the objects in the database. <a href="store_pilots.htm">Store Pilots</a> function is used to fill in the database.  </p><a name="SumPilotPoints"></a>
        <h2>SumPilotPoints</h2>
        <p>Calculate the sum of the points of all the pilots in the database. </p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: sumPilotPoints
private static void sumPilotPoints()  {
    ObjectContainer container = database();

    if (container != null)  {
      try  {
        SumPredicate sumPredicate = new SumPredicate();
        List&lt;Pilot&gt; result = container.query(sumPredicate);
        listResult(result);
        System.out.println("Sum of pilots points: " + sumPredicate.sum);
      } catch (Exception ex)  {
        System.out.println("System Exception: " + ex.getMessage());
      } finally  {
        closeDatabase();
      }
    }
  }</pre>
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: SumPredicate
private static class SumPredicate extends Predicate&lt;Pilot&gt;  {
    private int sum = 0;

    public boolean match(Pilot pilot)  {
      // return all pilots
      sum += pilot.getPoints();
      return true;
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:cs" />
        <p MadCap:conditions="Global.Primary:vb" /><a name="SelectMinPointsPilot"></a>
        <h2>SelectMinPointsPilot</h2>
        <p>Find a pilot having the minimum points. </p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: selectMinPointsPilot
private static void selectMinPointsPilot()  {
    ObjectContainer container = database();
    if (container != null)  {
      try  {
        List&lt;Pilot&gt; result = container.query(new Predicate&lt;Pilot&gt;()  {
          public boolean match(Pilot pilot)  {
            // return all pilots
            return true;
          }
        }, new QueryComparator&lt;Pilot&gt;()  {
          // sort by points then by name
          public int compare(Pilot p1, Pilot p2)  {
            return p1.getPoints() - p2.getPoints();
          }
        });
        if (result.size() &gt; 0)  {
          System.out.println("The min points result is: "
              + result.queryByExample(0));
        }
      } catch (Exception ex)  {
        System.out.println("System Exception: " + ex.getMessage());
      } finally  {
        closeDatabase();
      }
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:cs" />
        <p MadCap:conditions="Global.Primary:vb" /><a name="AveragePilotPoints"></a>
        <h2>AveragePilotPoints</h2>
        <p>Calculate what is the average amount of points for all the pilots in the database. </p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: averagePilotPoints
private static void averagePilotPoints()  {
    ObjectContainer container = database();

    if (container != null)  {
      try  {
        AveragePredicate averagePredicate = new AveragePredicate();
        List&lt;Pilot&gt; result = container.query(averagePredicate);
        if (averagePredicate.count &gt; 0)  {
          System.out
              .println("Average points for professional pilots: "
                  + averagePredicate.sum
                  / averagePredicate.count);
        } else  {
          System.out.println("No results");
        }
      } catch (Exception ex)  {
        System.out.println("System Exception: " + ex.getMessage());
      } finally  {
        closeDatabase();
      }
    }
  }</pre>
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: AveragePredicate
private static class AveragePredicate extends Predicate&lt;Pilot&gt;  {
    private int sum = 0;

    private int count = 0;

    public boolean match(Pilot pilot)  {
      // return professional pilots
      if (pilot.getName().startsWith("Professional"))  {
        sum += pilot.getPoints();
        count++;
        return true;
      }
      return false;
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:cs" />
        <p MadCap:conditions="Global.Primary:vb" /><a name="CountSubGroups"></a>
        <h2>CountSubGroups</h2>
        <p>Calculate how many pilots are in each group ("Test", "Professional").  </p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: countSubGroups
private static void countSubGroups()  {
    ObjectContainer container = database();
    if (container != null)  {
      try  {
        CountPredicate predicate = new CountPredicate();
        List&lt;Pilot&gt; result = container.query(predicate);
        listResult(result);
        Iterator keyIterator = predicate.countMap.keySet().iterator();
        while (keyIterator.hasNext())  {
          String key = keyIterator.next().toString();
          System.out
              .println(key + ": " + predicate.countMap.queryByExample(key));
        }
      } catch (Exception ex)  {
        System.out.println("System Exception: " + ex.getMessage());
      } finally  {
        closeDatabase();
      }
    }
  }</pre>
            <pre class="prettyprint" xml:space="preserve">CalculationExamples.java: CountPredicate
private static class CountPredicate extends Predicate&lt;Pilot&gt;  {

    private HashMap countMap = new HashMap();

    public boolean match(Pilot pilot)  {
      // return all Professional and Test pilots and count in
      // each category
      String[] keywords =  { "Professional", "Test" };
      for (int i = 0; i &lt; keywords.length; i++)  {
        if (pilot.getName().startsWith(keywords[i]))  {
          if (countMap.containsKey(keywords[i]))  {
            countMap.put(keywords[i], ((Integer) countMap
                .queryByExample(keywords[i])) + 1);
          } else  {
            countMap.put(keywords[i], 1);
          }
          return true;
        }
      }
      return false;
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:cs" />
        <p MadCap:conditions="Global.Primary:vb" />
        <p MadCap:conditions="Primary.Online">Download example code:</p>
        <p MadCap:conditions="Primary.Online">
            <MadCap:conditionalText MadCap:conditions="Primary.Java"><a href="nqcollectionjava.zip">Java </a>
            </MadCap:conditionalText>
        </p>
        <script type="text/javascript" src="../../SkinSupport/MadCapBodyEnd.js">
        </script>
    </body>
</html>