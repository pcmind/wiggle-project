<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="2" MadCap:lastHeight="120" MadCap:lastWidth="624" MadCap:disableMasterStylesheet="true" MadCap:tocPath="Implementation Strategies|Translators" MadCap:InPreviewMode="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" MadCap:PathToHelpSystem="../../../" MadCap:HelpSystemFileName="index.xml" MadCap:SearchType="Stem">
    <head><title>Java Example Class	</title>
        <script type="text/javascript">/* <![CDATA[ */
			window.onload = function(){
                             prettyPrint();
			};
                /* ]]> */</script>
        <link href="../../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../../Resources/Stylesheets/OnlineStyle.css" rel="stylesheet" />
        <script src="../../Resources/Code/prettify.js">
        </script>
        <script src="../../Resources/Code/lang-vb.js">
        </script>
        <script src="../../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink" style="display: none;"><a href="../../../index_CSH.html#implementation_strategies/translators/java_example_class.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../../implementation_strategies.htm">Implementation Strategies</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../translators.htm">Translators</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Java Example Class</span>
        </div>
        <p>
            <script type="text/javascript">/*<![CDATA[*/document.write('<a href="' + location.href +'">');
				document.write("Direct Link");
			document.write('</a>');/*]]>*/</script>
        </p>
        <p>
        </p>
        <h1>Java Example Class</h1>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <p>Let's use the following class as an example of a class which can not be stored clearly with db4o.</p>
            <pre class="prettyprint" xml:space="preserve">NotStorable.java
/**//* Copyright (C) 2004 - 2007 Versant Inc. http://www.db4o.com */
package com.db4odoc.translators;

public class NotStorable  {
  private int id;

  private String name;

  private transient int length;

  public NotStorable(int id, String name)  {
    this.id = id;
    this.name = name;
    this.length = name.length();
  }

  public int getId()  {
    return id;
  }

  public String getName()  {
    return name;
  }

  public int getLength()  {
    return length;
  }

  public String toString()  {
    return id + "/" + name + ": " + length;
  }
}</pre>
            <p>We'll be using this code to store and retrieve and instance of this class with different configuration settings:</p>
            <pre class="prettyprint" xml:space="preserve">TranslatorExample.java: tryStoreAndRetrieve
private static void tryStoreAndRetrieve(Configuration configuration)  {
    ObjectContainer container = Db4o.openFile(configuration, DB4O_FILE_NAME);
    try  {
      NotStorable notStorable = new NotStorable(42, "Test");
      System.out.println("ORIGINAL: " + notStorable);
      container.store(notStorable);
    } catch (Exception exc)  {
      System.out.println(exc.toString());
      return;
    } finally  {
      container.close();
    }
    container = Db4o.openFile(DB4O_FILE_NAME);
    try  {
      ObjectSet result = container.queryByExample(NotStorable.class);
      while (result.hasNext())  {
        NotStorable notStorable = (NotStorable) result.next();
        System.out.println("RETRIEVED: " + notStorable);
        container.delete(notStorable);
      }
    } finally  {
      container.close();
    }
  }</pre><a name="Bypassing the constuctor"></a>
            <h4>Bypassing the constructor</h4>
            <pre class="prettyprint" xml:space="preserve">TranslatorExample.java: tryStoreWithoutCallConstructors
private static void tryStoreWithoutCallConstructors()  {
    Configuration configuration = Db4o.newConfiguration();
    configuration.exceptionsOnNotStorable(false);
    configuration.objectClass(NotStorable.class)
        .callConstructor(false);
    tryStoreAndRetrieve(configuration);
  }</pre>
            <p>In
this case our object seems to be nicely stored and retrieved,
however, it has forgotten about its length, since db4o doesn't store
transient members and the constructor code that sets it is not executed.</p><a name="Using the constuctor"></a>
            <h4>Using the constructor</h4>
            <pre class="prettyprint" xml:space="preserve">TranslatorExample.java: tryStoreWithCallConstructors
private static void tryStoreWithCallConstructors()  {
    Configuration configuration = Db4o.newConfiguration();
    configuration.exceptionsOnNotStorable(true);
    configuration.objectClass(NotStorable.class)
        .callConstructor(true);
    tryStoreAndRetrieve(configuration);
  }</pre>
            <p>At
storage time, db4o tests the only available constructor with null
arguments and runs into a NullPointerException, so it refuses to accept
our object.</p>
            <p>(Note that this test only occurs when configured
with exceptionsOnNotStorable (default setting is true) - otherwise db4o will silently fail when
trying to reinstantiate the object.)</p>
            <p>This
still does not work for our case because the native pointer will
definitely be invalid. </p>
            <p>In order to solve the problem we will need to use <a href="the_translator_api.htm">db4o Translators</a>.   </p>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <script type="text/javascript" src="../../SkinSupport/MadCapBodyEnd.js">
        </script>
    </body>
</html>