<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:lastBlockDepth="2" MadCap:lastHeight="120" MadCap:lastWidth="624" MadCap:disableMasterStylesheet="true" MadCap:tocPath="db4o Testing Framework" MadCap:InPreviewMode="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" MadCap:PathToHelpSystem="../../" MadCap:HelpSystemFileName="index.xml" MadCap:SearchType="Stem">
    <head><title>Creating A Sample Test	</title>
        <script type="text/javascript">/* <![CDATA[ */
			window.onload = function(){
                             prettyPrint();
			};
                /* ]]> */</script>
        <link href="../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/OnlineStyle.css" rel="stylesheet" />
        <script src="../Resources/Code/prettify.js">
        </script>
        <script src="../Resources/Code/lang-vb.js">
        </script>
        <script src="../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink" style="display: none;"><a href="../../index_CSH.html#db4o_testing_framework/creating_a_sample_test.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../db4o_testing_framework.htm">db4o Testing Framework</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Creating A Sample Test</span>
        </div>
        <p>
            <script type="text/javascript">/*<![CDATA[*/document.write('<a href="' + location.href +'">');
				document.write("Direct Link");
			document.write('</a>');/*]]>*/</script>
        </p>
        <p>
        </p>
        <h1>Creating A Sample Test</h1>
        <p>Let's create a simple test case
to check if the cascade on update setting is working as expected. </p>
        <p>We will use a simple linked list
class:</p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CascadeOnUpdate.java: Atom
public static class Atom  {
    
    public Atom child;
    public String name;
    
    public Atom() {
    }
    
    public Atom(Atom child) {
      this.child = child;
    }
    
    public Atom(String name) {
      this.name = name;
    }
    
    public Atom(Atom child, String name) {
      this(child);
      this.name = name;
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:net" />
        <p>Custom configuration should be
added to configure method:</p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CascadeOnUpdate.java: configure
protected void configure(Configuration conf)  {
    conf.objectClass(Atom.class).cascadeOnUpdate(false);
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:net" />
        <p>To prepare the database we will
need to store some Atom objects:</p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CascadeOnUpdate.java: store
protected void store()  {
    Atom atom = new Atom(new Atom(new Atom("storedGrandChild"), "storedChild"),"parent");
    db().store(atom);
    db().commit();
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:net" />
        <p>Now we are ready to test the
expected behavior:</p>
        <p MadCap:conditions="Primary.Java,Primary.All languages">
            <pre class="prettyprint" xml:space="preserve">CascadeOnUpdate.java: test
public void test() throws Exception  {
    Query q = newQuery(Atom.class);
    q.descend("name").constrain("parent");
    ObjectSet objectSet = q.execute();
    Atom atom = null;
    while (objectSet.hasNext()) {
      // update child objects
      atom = (Atom)objectSet.next();
      ((Atom)atom.child).name = "updated";
      ((Atom)atom.child).child.name = "notUpdated";
      // store the parent object
      db().store(atom);
    }
    
    // commit and refresh to make sure that the changes are saved
    // and reference cash is refreshed
    db().commit();
    db().refresh(atom, Integer.MAX_VALUE);
    
    
    q = newQuery(Atom.class);
    q.descend("name").constrain("parent");
    objectSet = q.execute();
    while(objectSet.hasNext()) {
      atom = (Atom) objectSet.next();
      Atom child = (Atom)atom.child;
      // check if the child objects were updated
      Assert.areEqual("updated", child.name);
      Assert.areNotEqual("updated", child.child.name);
    }
  }</pre>
        </p>
        <p MadCap:conditions="Global.Primary:java" />
        <p MadCap:conditions="Global.Primary:net" />
        <p MadCap:conditions="Primary.Online">Download example code:</p>
        <p MadCap:conditions="Primary.Online">
            <MadCap:conditionalText MadCap:conditions="Primary.Java"><a href="testsjava.zip">Java </a>
            </MadCap:conditionalText>
        </p>
        <script type="text/javascript" src="../SkinSupport/MadCapBodyEnd.js">
        </script>
    </body>
</html>